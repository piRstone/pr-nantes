{"version":3,"sources":["dataProvider.js","utils/hooks/useOnClickOutside.js","components/LayerSelector/index.js","components/Header/index.js","components/Marker/index.js","components/Popup/RealTimeParkRide.js","components/Popup/FreeParkRide.js","components/Popup/index.js","utils/data/index.js","Map.js","App.js","serviceWorker.js","index.js"],"names":["AppDataContext","createContext","DataProvider","children","useState","appData","setAppData","Provider","value","newData","useOnClickOutside","ref","handler","useEffect","listener","event","current","contains","target","document","addEventListener","removeEventListener","LayerSelector","onToggleAllParks","showPopup","setShowPopup","useContext","popupRef","useRef","className","onClick","icon","faLayerGroup","size","id","type","checked","showAllParks","onChange","htmlFor","Header","data","onRefresh","isLoading","undefined","timestamp","setTimestamp","length","ts","record_timestamp","date","Date","hours","getHours","minutes","getMinutes","count","faRedoAlt","color","spin","Marker","fields","grp_disponible","status","grp_statut","RealTimeParkRidePopup","countSentence","grp_nom","grp_exploitation","countClassName","FreeParkRidePopup","console","info","properties","nom_complet","capacite_voiture","src","process","alt","popupTypes","Popup","visible","wrapperClassName","RealTimeParkRide","FreeParkRide","getAllParks","a","fetch","response","json","records","Error","getRealTimeParks","Map","map","setMap","setData","allParks","setAllParks","setIsLoading","popupData","setPopupData","mapContainer","storedShowAllParks","localStorage","getItem","mapboxgl","container","style","center","zoom","on","resize","dragRotate","disable","loadImage","error","image","addImage","handleParkSymbolClick","initMap","getData","handlePointClick","useCallback","point","idobj","setTimeout","forEach","location","places","el","createElement","innerText","markerNode","ReactDOM","render","element","setLngLat","addTo","source","features","feature","geometry","coordinates","name","push","getSource","addSource","addLayer","layout","visibility","setLayoutProperty","realTimeParks","e","log","getLayoutProperty","show","setItem","App","Boolean","window","hostname","match","accessToken","StrictMode","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","message"],"mappings":"+VAGaA,EAAiBC,0BAqBfC,EAnBM,SAAC,GAAkB,IAAhBC,EAAe,EAAfA,SAAe,EACPC,mBAAS,IADF,mBAC9BC,EAD8B,KACrBC,EADqB,KAGrC,OACE,kBAACN,EAAeO,SAAhB,CACEC,MAAO,CACLH,UACAC,WAAY,SAACG,GAAD,OAAaH,EAAW,2BAAKD,GAAYI,OAGtDN,I,6CCWQO,G,YAxBW,SAACC,EAAKC,GAC9BC,qBACE,WACE,IAAMC,EAAW,SAAAC,GAEVJ,EAAIK,UAAWL,EAAIK,QAAQC,SAASF,EAAMG,SAI/CN,EAAQG,IAMV,OAHAI,SAASC,iBAAiB,YAAaN,GACvCK,SAASC,iBAAiB,aAAcN,GAEjC,WACLK,SAASE,oBAAoB,YAAaP,GAC1CK,SAASE,oBAAoB,aAAcP,MAG/C,CAACH,EAAKC,MCkBKU,EAhCO,SAAC,GAA0B,IAAxBC,EAAuB,EAAvBA,iBAAuB,EACZnB,oBAAS,GADG,mBACvCoB,EADuC,KAC5BC,EAD4B,KAEtCpB,EAAYqB,qBAAW1B,GAAvBK,QAEFsB,EAAWC,mBAGjB,OAFAlB,EAAkBiB,GAAU,WAAQF,GAAa,MAG/C,yBAAKd,IAAKgB,EAAUE,UAAU,kBAC5B,yBAAKA,UAAU,eAAeC,QAAS,kBAAML,GAAcD,KACzD,kBAAC,IAAD,CAAiBO,KAAMC,IAAcH,UAAU,aAAaI,KAAK,QAElET,GACC,yBAAKK,UAAU,eACb,yBAAKA,UAAU,aACb,2BACEK,GAAG,mBACHL,UAAU,cACVM,KAAK,WACLC,QAAS/B,EAAQgC,aACjBC,SAAUf,IAEZ,2BAAOgB,QAAQ,mBAAmBV,UAAU,eAA5C,yCCiCGW,MAtDf,YAAmE,IAAjDC,EAAgD,EAAhDA,KAAMC,EAA0C,EAA1CA,UAAWnB,EAA+B,EAA/BA,iBAAkBoB,EAAa,EAAbA,UAAa,EAC9BvC,wBAASwC,GADqB,mBACzDC,EADyD,KAC9CC,EAD8C,KAGxDxC,EAAeoB,qBAAW1B,GAA1BM,WAiBR,OAdAO,qBAAU,WACR,GAAI4B,EAAKM,OAAQ,CACf,IAAMC,EAAKP,EAAK,GAAGQ,iBACbC,EAAO,IAAIC,KAAKH,GAEhBI,EAAQF,EAAKG,WACfC,EAAUJ,EAAKK,aACnBD,EAAUA,EAAU,GAAV,WAAmBA,GAAYA,EAEzCR,EAAa,GAAD,OAAIM,EAAJ,YAAaE,IACzBhD,EAAW,CAAEkD,MAAOf,EAAKM,YAE1B,CAACN,IAGF,yBAAKZ,UAAU,kBACb,gCACE,wBAAIA,UAAU,gBAAd,cACA,uBAAGA,UAAU,kBAAb,WAEDgB,GACC,yBAAKhB,UAAU,4BACb,6DAA6BgB,GAC7B,4BACEV,KAAK,SACLL,QAASY,EACTb,UAAU,yBAEV,kBAAC,IAAD,CACEE,KAAM0B,IACNC,MAAM,UACNC,KAAMhB,MAKd,kBAAC,EAAD,CAAepB,iBAAkBA,M,MCxBxBqC,MAvBf,YAAoC,IAAlBnB,EAAiB,EAAjBA,KAAMX,EAAW,EAAXA,QAClB0B,EAAQf,EAAKoB,OAAOC,eAClBC,EAAStB,EAAKoB,OAAOG,WACvBnC,EAAS,iBACD,IAAV2B,EAAc,SAAWA,EAAQ,GAAK,UAAY,IAWpD,OARe,IAAXO,GACFlC,GAAa,WACb2B,EAAQ,KACY,IAAXO,IACTlC,EAAY,gBACZ2B,EAAQ,KAGH,yBAAK1B,QAAS,kBAAMA,EAAQW,IAAOZ,UAAWA,GAAY2B,IC6BpDS,G,MA7Ce,SAAC,GAAc,IAQvCC,EARsC,IAAXzB,KACwCoB,OAA/DM,EADkC,EAClCA,QAASL,EADyB,EACzBA,eAAgBM,EADS,EACTA,iBAAkBJ,EADT,EACSA,WAC/CR,EAAQM,EAERO,EAAc,sBACN,IAAVb,EAAc,SAAWA,EAAQ,GAAK,UAAY,IAsBpD,OAjBEU,EADY,IAAVV,EACc,0BACG,IAAVA,EACO,qBAEH,UAAMA,EAAN,uBAGI,IAAfQ,GACFE,EAAgB,wBAChBV,EAAQ,IACRa,GAAkB,YACM,IAAfL,IACTE,EAAgB,mBAChBV,EAAQ,IACRa,EAAiB,sBAIjB,yBAAKxC,UAAU,iBACb,yBAAKA,UAAWwC,GAAiBb,GACjC,yBAAK3B,UAAU,sBACb,wBAAIA,UAAU,mBAAmBsC,GACjC,uBAAGtC,UAAU,IAAIqC,GACjB,yDAC6B,gCAASE,QCP/BE,EA3BW,SAAC,GAAc,IAAZ7B,EAAW,EAAXA,KAC3B8B,QAAQC,KAAK,OAAQ/B,GADiB,MAKlCA,EAAKgC,WAFPC,EAHoC,EAGpCA,YACAC,EAJoC,EAIpCA,iBAGF,OACE,yBAAK9C,UAAU,iBACb,yBACE+C,IAAG,UAAKC,GAAL,8BACHC,IAAI,iBAEN,yBAAKjD,UAAU,sBACb,wBAAIA,UAAU,mBAAmB6C,GACjC,yDAC6B,gCAASC,OCZjCI,EACO,WADPA,EAEG,eAwBDC,MArBf,YAA4C,IAA3BvC,EAA0B,EAA1BA,KAAMwC,EAAoB,EAApBA,QAASnD,EAAW,EAAXA,QAC9B,IAAKW,EAAM,OAAO,yBAAKZ,UAAU,UAEjC,IAAMqD,EAAgB,gBAAYD,EAAU,UAAY,IAExD,OACE,yBAAKpD,UAAWqD,EAAkBpD,QAASA,GACxCW,EAAKN,OAAS4C,GACb,kBAACI,EAAD,CAAuB1C,KAAMA,EAAKA,OAEnCA,EAAKN,OAAS4C,GAA2B,kBAACK,EAAD,CAAmB3C,KAAMA,EAAKA,SCtBjE4C,EAAW,uCAAG,8BAAAC,EAAA,4DAEvB,6OAFuB,kBAKAC,MAHvB,8OAFuB,cAKjBC,EALiB,gBAMJA,EAASC,OANL,cAMjBhD,EANiB,yBAOhBA,EAAKiD,SAPW,wCASjBC,MAAM,EAAD,IATY,0DAAH,qDAaXC,EAAgB,uCAAG,8BAAAN,EAAA,4DAE5B,mKAF4B,kBAKLC,MAHvB,oKAF4B,cAKtBC,EALsB,gBAMTA,EAASC,OANA,cAMtBhD,EANsB,yBAOrBA,EAAKiD,SAPgB,wCAStBC,MAAM,EAAD,IATiB,0DAAH,qDC4OdE,MAxOf,WAAgB,IAAD,EACmBnE,qBAAW1B,GAAnCK,EADK,EACLA,QAASC,EADJ,EACIA,WADJ,EAGSF,mBAAS,MAHlB,mBAGN0F,EAHM,KAGDC,EAHC,OAIW3F,mBAAS,IAJpB,mBAINqC,EAJM,KAIAuD,EAJA,OAKmB5F,mBAAS,IAL5B,mBAKN6F,EALM,KAKIC,EALJ,OAMqB9F,oBAAS,GAN9B,mBAMNuC,EANM,KAMKwD,EANL,OAOqB/F,wBAASwC,GAP9B,mBAONwD,EAPM,KAOKC,EAPL,OAQqBjG,oBAAS,GAR9B,mBAQNoB,EARM,KAQKC,EARL,KAUP6E,EAAe1E,mBAGrBf,qBAAU,WACR,IA2BM0F,EAAqBC,aAAaC,QAAQ,gBAC5CF,GAEFjG,EAAW,CAAE+B,aADsB,SAAvBkE,IAITT,GAjCW,SAAC,GAA8B,IAA5BC,EAA2B,EAA3BA,OAAQO,EAAmB,EAAnBA,aACnBR,EAAM,IAAIY,IAASb,IAAI,CAC3Bc,UAAWL,EAAatF,QACxB4F,MAAO,qCACPC,OAAQ,EAAE,OAAQ,SAClBC,KAAM,KAGRhB,EAAIiB,GAAG,QAAQ,WACbhB,EAAOD,GACPA,EAAIkB,SACJlB,EAAImB,WAAWC,UAGfpB,EAAIqB,UACuB,8BACzB,SAACC,EAAOC,GACN,GAAID,EAAO,MAAMA,EACjBtB,EAAIwB,SAAS,iBAAkBD,MAKnCvB,EAAIiB,GAAG,QAAS,YAAaQ,MAUvBC,CAAQ,CAAEzB,SAAQO,iBAE5BmB,MACC,IAEH,IAAMC,EAAmBC,uBACvB,SAACC,GACC,GAAIxB,IACYA,EAAU3D,KAAKoB,OACzBuC,EAAU3D,KAAKoB,OAAOgE,MACtBzB,EAAU3D,KAAKgC,WAAWoD,SAChBD,EAAM/D,OAAOgE,MAOzB,OANApG,GAAa,QAGbqG,YAAW,WACTzB,OAAazD,KACZ,KAKPyD,EAAa,CAAElE,KAAM4C,EAA6BtC,KAAMmF,IACxDnG,GAAa,KAEf,CAAC2E,IAIHvF,qBAAU,WACJiF,GAAOrD,EAAKM,QACdN,EAAKsF,SAAQ,SAACH,GAAW,IAAD,EACtB,aAAIA,EAAM/D,cAAV,aAAI,EAAcmE,SAAU,CAC1B,IAAMC,EAASL,EAAM/D,OAAOC,eAEtBoE,EAAK/G,SAASgH,cAAc,OAClCD,EAAGrG,UAAH,iBACa,IAAXoG,EAAe,SAAWA,EAAS,GAAK,UAAY,IAEtDC,EAAGE,UAAYH,EAEf,IAAMI,EAAalH,SAASgH,cAAc,OAC1CG,IAASC,OACP,kBAAC,EAAD,CAAQ9F,KAAMmF,EAAO9F,QAAS4F,IAC9BW,GAGF,IAAML,EAAWJ,EAAM/D,OAAOmE,SAE9B,IAAItB,IAAS9C,OAAO,CAAE4E,QAASH,IAC5BI,UAAU,CAACT,EAAS,GAAIA,EAAS,KACjCU,MAAM5C,SAId,CAACA,EAAKrD,EAAMiF,IAGf7G,qBAAU,WACR,GAAIiF,GAAOG,EAASlD,OAAQ,CAC1B,IAAI4F,EAAS,CACXxG,KAAM,UACNM,KAAM,CACJN,KAAM,oBACNyG,SAAU,KAyBd,GArBA3C,EAAS8B,SAAQ,SAACH,GAAW,IAAD,EAC1B,aAAIA,EAAM/D,cAAV,aAAI,EAAcmE,SAAU,CAC1B,IAAMA,EAAWJ,EAAM/D,OAAOmE,SAGxBa,EAAU,CACd1G,KAAM,UACN2G,SAAU,CACR3G,KAAM,QACN4G,YANgB,CAACf,EAAS,GAAIA,EAAS,KAQzCvD,WAAW,aACTuE,KAAMpB,EAAM/D,OAAOa,aAChBkD,EAAM/D,SAIb8E,EAAOlG,KAAKmG,SAASK,KAAKJ,QAIzB/C,EAAIoD,UAAU,oBAAqB,CACtCpD,EAAIqD,UAAU,mBAAoBR,GAClC7C,EAAIsD,SAAS,CACXlH,GAAI,YACJC,KAAM,SACNwG,OAAQ,mBACRU,OAAQ,CACN,aAAc,iBACd,YAAa,OAKjB,IAAMC,GAAsC,IAAzBjJ,EAAQgC,aAAwB,UAAY,OAC/DyD,EAAIyD,kBAAkB,YAAa,aAAcD,OAGpD,CAACxD,EAAKG,EAAU5F,IAEnB,IAAMoH,EAAO,uCAAG,8BAAAnC,EAAA,6DACda,GAAa,GADC,kBAKWd,IALX,OAKNY,EALM,OAMZC,EAAYD,GANA,gDAQZ1B,QAAQ6C,MAAR,MARY,mCAagBxB,IAbhB,QAaN4D,EAbM,OAcZxD,EAAQwD,GAdI,mDAgBZjF,QAAQ6C,MAAR,MAhBY,QAmBdjB,GAAa,GAnBC,iEAAH,qDAkCPoB,EAAwB,SAACkC,GAC7BlF,QAAQmF,IAAID,GACZlF,QAAQmF,IAAID,EAAEb,SAAS,IAEvB,IAAMhB,EAAQ6B,EAAEb,SAAS,GAEzB,GAAIxC,IACYA,EAAU3D,KAAKoB,OACzBuC,EAAU3D,KAAKoB,OAAOgE,MACtBzB,EAAU3D,KAAKgC,WAAWoD,SAChBD,EAAMnD,WAAWoD,MAO7B,OANApG,GAAa,QAGbqG,YAAW,WACTzB,OAAazD,KACZ,KAKPyD,EAAa,CAAElE,KAAM4C,EAAyBtC,KAAMmF,IACpDnG,GAAa,IAGf,OACE,yBAAKI,UAAU,OACb,yBAAKlB,IAAK2F,EAAczE,UAAU,iBAClC,kBAAC,EAAD,CACEY,KAAMA,EACNC,UAAW+E,EACXlG,iBA3CiB,WACrB,IAAM+H,EAAaxD,EAAI6D,kBAAkB,YAAa,cACtD7D,EAAIyD,kBACF,YACA,aACe,SAAfD,EAAwB,UAAY,QAEtC,IAAMM,EAAsB,SAAfN,EACb9C,aAAaqD,QAAQ,eAAgBD,GACrCtJ,EAAW,CAAE+B,aAAcuH,KAmCvBjH,UAAWA,IAEb,kBAAC,EAAD,CACEF,KAAM2D,EACNnB,QAASzD,EACTM,QAAS,kBAAML,GAAa,QCpOrBqI,EAVH,WACV,OACE,kBAAC,EAAD,KACE,yBAAKjI,UAAU,OACb,kBAAC,EAAD,SCGYkI,QACW,cAA7BC,OAAOhC,SAASiC,UAEe,UAA7BD,OAAOhC,SAASiC,UAEhBD,OAAOhC,SAASiC,SAASC,MACvB,2DCXNxD,IAASyD,YAActF,6FAEvByD,IAASC,OACP,kBAAC,IAAM6B,WAAP,KACE,kBAAC,EAAD,OAEFjJ,SAASkJ,eAAe,SDsHpB,kBAAmBC,WACrBA,UAAUC,cAAcC,MACrBC,MAAK,SAAAC,GACJA,EAAaC,gBAEdC,OAAM,SAAAxD,GACL7C,QAAQ6C,MAAMA,EAAMyD,c","file":"static/js/main.fec54eb6.chunk.js","sourcesContent":["import React, { createContext, useState } from \"react\";\nimport PropTypes from \"prop-types\";\n\nexport const AppDataContext = createContext();\n\nconst DataProvider = ({ children }) => {\n  const [appData, setAppData] = useState({});\n\n  return (\n    <AppDataContext.Provider\n      value={{\n        appData,\n        setAppData: (newData) => setAppData({ ...appData, ...newData }),\n      }}\n    >\n      {children}\n    </AppDataContext.Provider>\n  );\n};\n\nDataProvider.propTypes = {\n  children: PropTypes.node.isRequired,\n};\n\nexport default DataProvider;\n","import { useEffect } from 'react';\n\nconst useOnClickOutside = (ref, handler) => {\n  useEffect(\n    () => {\n      const listener = event => {\n        // Do nothing if clicking ref's element or descendent elements\n        if (!ref.current || ref.current.contains(event.target)) {\n          return;\n        }\n\n        handler(event);\n      };\n\n      document.addEventListener('mousedown', listener);\n      document.addEventListener('touchstart', listener);\n\n      return () => {\n        document.removeEventListener('mousedown', listener);\n        document.removeEventListener('touchstart', listener);\n      };\n    },\n    [ref, handler],\n  );\n};\n\nexport default useOnClickOutside;\n","import React, { useState, useContext, useRef } from \"react\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faLayerGroup } from \"@fortawesome/free-solid-svg-icons\";\nimport \"./style.css\";\n\nimport { useOnClickOutside } from '../../utils/hooks';\nimport { AppDataContext } from \"../../dataProvider\";\n\nconst LayerSelector = ({ onToggleAllParks }) => {\n  const [showPopup, setShowPopup] = useState(false);\n  const { appData } = useContext(AppDataContext);\n\n  const popupRef = useRef();\n  useOnClickOutside(popupRef, () => { setShowPopup(false) });\n\n  return (\n    <div ref={popupRef} className=\"layer-selector\">\n      <div className=\"layer-button\" onClick={() => setShowPopup(!showPopup)}>\n        <FontAwesomeIcon icon={faLayerGroup} className=\"layer-icon\" size=\"lg\" />\n      </div>\n      {showPopup && (\n        <div className=\"layer-popup\">\n          <div className=\"layer-row\">\n            <input\n              id=\"toggle-all-parks\"\n              className=\"layer-input\"\n              type=\"checkbox\"\n              checked={appData.showAllParks}\n              onChange={onToggleAllParks}\n            />\n            <label htmlFor=\"toggle-all-parks\" className=\"layer-label\">\n              Afficher tous les parkings relais\n            </label>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default LayerSelector;\n","import React, { useEffect, useState, useContext } from 'react';\nimport PropTypes from 'prop-types';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faRedoAlt } from '@fortawesome/free-solid-svg-icons';\nimport './header.css';\n\nimport { AppDataContext } from '../../dataProvider';\nimport LayerSelector from '../LayerSelector';\n\nfunction Header({ data, onRefresh, onToggleAllParks, isLoading }) {\n  const [timestamp, setTimestamp] = useState(undefined);\n\n  const { setAppData } = useContext(AppDataContext);\n\n  // Set last sync time\n  useEffect(() => {\n    if (data.length) {\n      const ts = data[0].record_timestamp;\n      const date = new Date(ts);\n\n      const hours = date.getHours();\n      let minutes = date.getMinutes();\n      minutes = minutes < 10 ? `0${minutes}` : minutes;\n\n      setTimestamp(`${hours}h${minutes}`);\n      setAppData({ count: data.length });\n    }\n  }, [data]);\n\n  return (\n    <div className=\"header-wrapper\">\n      <header>\n        <h1 className=\"header-title\">P+R Nantes</h1>\n        <p className=\"header-version\">v1.2.0</p>\n      </header>\n      {timestamp && (\n        <div className=\"header-timestamp-wrapper\">\n          <p>Mis à jour aujourd'hui à {timestamp}</p>\n          <button\n            type=\"button\"\n            onClick={onRefresh}\n            className=\"header-refresh-button\"\n          >\n            <FontAwesomeIcon\n              icon={faRedoAlt}\n              color=\"#616161\"\n              spin={isLoading}\n            />\n          </button>\n        </div>\n      )}\n      <LayerSelector onToggleAllParks={onToggleAllParks} />\n    </div>\n  );\n}\n\nHeader.propTypes = {\n  data: PropTypes.arrayOf(PropTypes.object),\n  onRefresh: PropTypes.func.isRequired,\n  onToggleAllParks: PropTypes.func.isRequired,\n  isLoading: PropTypes.bool.isRequired,\n};\n\nexport default Header;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport './marker.css';\n\nfunction Marker({ data, onClick }) {\n  let count = data.fields.grp_disponible;\n  const status = data.fields.grp_statut;\n  let className = `marker ${\n    count === 0 ? 'danger' : count < 10 ? 'warning' : ''\n  }`;\n\n  if (status === 0) {\n    className += ' invalid';\n    count = 'X';\n  } else if (status === 1) {\n    className = 'marker danger';\n    count = 'X';\n  }\n\n  return <div onClick={() => onClick(data)} className={className}>{count}</div>;\n}\n\nMarker.propTypes = {\n  data: PropTypes.object,\n  onClick: PropTypes.func.isRequired\n}\n\nexport default Marker;\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nconst RealTimeParkRidePopup = ({ data }) => {\n  const { grp_nom, grp_disponible, grp_exploitation, grp_statut } = data.fields;\n  let count = grp_disponible;\n\n  let countClassName = `popup-count ${\n    count === 0 ? 'danger' : count < 10 ? 'warning' : ''\n  }`;\n\n  let countSentence;\n  if (count === 0) {\n    countSentence = 'Aucune place disponible';\n  } else if (count === 1) {\n    countSentence = '1 place disponible';\n  } else {\n    countSentence = `${count} places disponibles`;\n  }\n\n  if (grp_statut === 0) {\n    countSentence = 'Comptage hors service';\n    count = 'X';\n    countClassName += ' invalid';\n  } else if (grp_statut === 1) {\n    countSentence = 'Parking fermé';\n    count = 'X';\n    countClassName = 'popup-count danger';\n  }\n\n  return (\n    <div className=\"popup-wrapper\">\n      <div className={countClassName}>{count}</div>\n      <div className=\"popup-informations\">\n        <h3 className=\"popup-park-name\">{grp_nom}</h3>\n        <p className=\"\">{countSentence}</p>\n        <p>\n          Nombre de places totales : <strong>{grp_exploitation}</strong>\n        </p>\n      </div>\n    </div>\n  );\n};\n\nRealTimeParkRidePopup.propTypes = {\n  data: PropTypes.object.isRequired,\n};\n\nexport default RealTimeParkRidePopup;\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nconst FreeParkRidePopup = ({ data }) => {\n  console.info('INFO', data)\n  const {\n    nom_complet,\n    capacite_voiture,\n  } = data.properties;\n\n  return (\n    <div className=\"popup-wrapper\">\n      <img\n        src={`${process.env.PUBLIC_URL}/img/parking-symbol@2x.png`}\n        alt=\"Parking icon\"\n      />\n      <div className=\"popup-informations\">\n        <h3 className=\"popup-park-name\">{nom_complet}</h3>\n        <p>\n          Nombre de places totales : <strong>{capacite_voiture}</strong>\n        </p>\n      </div>\n    </div>\n  );\n};\n\nFreeParkRidePopup.propTypes = {\n  data: PropTypes.object.isRequired,\n};\n\nexport default FreeParkRidePopup;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport './popup.css';\n\nimport RealTimeParkRidePopup from './RealTimeParkRide';\nimport FreeParkRidePopup from './FreeParkRide';\n\nexport const popupTypes = {\n  realTimeParkRide: 'realTime',\n  freeParkRide: 'freeParkRide',\n};\n\nfunction Popup({ data, visible, onClick }) {\n  if (!data) return <div className=\"popup\"></div>;\n\n  const wrapperClassName = `popup ${visible ? 'visible' : ''}`;\n\n  return (\n    <div className={wrapperClassName} onClick={onClick}>\n      {data.type === popupTypes.realTimeParkRide && (\n        <RealTimeParkRidePopup data={data.data} />\n      )}\n      {data.type === popupTypes.freeParkRide && <FreeParkRidePopup data={data.data} />}\n    </div>\n  );\n}\n\nPopup.propTypes = {\n  data: PropTypes.object,\n  visible: PropTypes.bool.isRequired,\n  onClick: PropTypes.func.isRequired\n}\n\nexport default Popup;\n","export const getAllParks = async () => {\n  const allParksUrl =\n    \"https://data.nantesmetropole.fr/api/records/1.0/search/?dataset=244400404_parcs-relais-nantes-metropole&q=&rows=100&facet=libtype&facet=commune&facet=service_velo&facet=autres_service_mob_prox&facet=conditions_d_acces&facet=exploitant\";\n\n  try {\n    const response = await fetch(allParksUrl);\n    const data = await response.json();\n    return data.records;\n  } catch (e) {\n    throw Error(e);\n  }\n};\n\nexport const getRealTimeParks = async () => {\n  const realTimeUrl =\n    \"https://data.nantesmetropole.fr/api/records/1.0/search/?dataset=244400404_parcs-relais-nantes-metropole-disponibilites&q=&rows=30&facet=grp_nom&facet=grp_statut\";\n\n  try {\n    const response = await fetch(realTimeUrl);\n    const data = await response.json();\n    return data.records;\n  } catch (e) {\n    throw Error(e);\n  }\n};\n","import React, {\n  useEffect,\n  useState,\n  useRef,\n  useCallback,\n  useContext,\n} from \"react\";\nimport ReactDOM from \"react-dom\";\nimport mapboxgl from \"mapbox-gl\";\nimport \"./Map.css\";\n\nimport { AppDataContext } from \"./dataProvider\";\nimport Header from \"./components/Header\";\nimport Marker from \"./components/Marker\";\nimport Popup, { popupTypes } from \"./components/Popup\";\nimport { getAllParks, getRealTimeParks } from \"./utils/data\";\n\nfunction Map() {\n  const { appData, setAppData } = useContext(AppDataContext);\n\n  const [map, setMap] = useState(null);\n  const [data, setData] = useState([]);\n  const [allParks, setAllParks] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [popupData, setPopupData] = useState(undefined);\n  const [showPopup, setShowPopup] = useState(false);\n\n  const mapContainer = useRef();\n\n  // Init\n  useEffect(() => {\n    const initMap = ({ setMap, mapContainer }) => {\n      const map = new mapboxgl.Map({\n        container: mapContainer.current,\n        style: \"mapbox://styles/mapbox/streets-v11\",\n        center: [-1.5543, 47.2107],\n        zoom: 10,\n      });\n\n      map.on(\"load\", () => {\n        setMap(map);\n        map.resize();\n        map.dragRotate.disable();\n\n        // Load and declare park symbol\n        map.loadImage(\n          process.env.PUBLIC_URL + \"/img/parking-symbol@3x.png\",\n          (error, image) => {\n            if (error) throw error;\n            map.addImage(\"parking-symbol\", image);\n          }\n        );\n\n        // Handle parks symbols clicks\n        map.on(\"click\", \"all-parks\", handleParkSymbolClick);\n      });\n    };\n\n    const storedShowAllParks = localStorage.getItem(\"showAllParks\");\n    if (storedShowAllParks) {\n      const val = storedShowAllParks === \"true\" ? true : false;\n      setAppData({ showAllParks: val });\n    }\n\n    if (!map) initMap({ setMap, mapContainer });\n\n    getData();\n  }, []);\n\n  const handlePointClick = useCallback(\n    (point) => {\n      if (popupData) {\n        const idobj = popupData.data.fields\n          ? popupData.data.fields.idobj\n          : popupData.data.properties.idobj;\n        if (idobj === point.fields.idobj) {\n          setShowPopup(false);\n\n          // Clear data after animation\n          setTimeout(() => {\n            setPopupData(undefined);\n          }, 300);\n          return;\n        }\n      }\n\n      setPopupData({ type: popupTypes.realTimeParkRide, data: point });\n      setShowPopup(true);\n    },\n    [popupData]\n  );\n\n  // Display real time data on map\n  useEffect(() => {\n    if (map && data.length) {\n      data.forEach((point) => {\n        if (point.fields?.location) {\n          const places = point.fields.grp_disponible;\n\n          const el = document.createElement(\"div\");\n          el.className = `marker ${\n            places === 0 ? \"danger\" : places < 10 ? \"warning\" : \"\"\n          }`;\n          el.innerText = places;\n\n          const markerNode = document.createElement(\"div\");\n          ReactDOM.render(\n            <Marker data={point} onClick={handlePointClick} />,\n            markerNode\n          );\n\n          const location = point.fields.location;\n\n          new mapboxgl.Marker({ element: markerNode })\n            .setLngLat([location[1], location[0]])\n            .addTo(map);\n        }\n      });\n    }\n  }, [map, data, handlePointClick]);\n\n  // Display all parks on map\n  useEffect(() => {\n    if (map && allParks.length) {\n      let source = {\n        type: \"geojson\",\n        data: {\n          type: \"FeatureCollection\",\n          features: [],\n        },\n      };\n\n      allParks.forEach((point) => {\n        if (point.fields?.location) {\n          const location = point.fields.location;\n          const coordinates = [location[1], location[0]];\n\n          const feature = {\n            type: \"Feature\",\n            geometry: {\n              type: \"Point\",\n              coordinates,\n            },\n            properties: {\n              name: point.fields.nom_complet,\n              ...point.fields,\n            },\n          };\n\n          source.data.features.push(feature);\n        }\n      });\n\n      if (!map.getSource(\"all-parks-source\")) {\n        map.addSource(\"all-parks-source\", source);\n        map.addLayer({\n          id: \"all-parks\",\n          type: \"symbol\",\n          source: \"all-parks-source\",\n          layout: {\n            \"icon-image\": \"parking-symbol\",\n            \"icon-size\": 0.25,\n          },\n        });\n\n        // Set visibility according to user choice\n        const visibility = appData.showAllParks === true ? \"visible\" : \"none\";\n        map.setLayoutProperty(\"all-parks\", \"visibility\", visibility);\n      }\n    }\n  }, [map, allParks, appData]);\n\n  const getData = async () => {\n    setIsLoading(true);\n\n    // Get all parks of Nantes\n    try {\n      const allParks = await getAllParks();\n      setAllParks(allParks);\n    } catch (e) {\n      console.error(e);\n    }\n\n    // Get parks with real time places numbers\n    try {\n      const realTimeParks = await getRealTimeParks();\n      setData(realTimeParks);\n    } catch (e) {\n      console.error(e);\n    }\n\n    setIsLoading(false);\n  };\n\n  const toggleAllParks = () => {\n    const visibility = map.getLayoutProperty(\"all-parks\", \"visibility\");\n    map.setLayoutProperty(\n      \"all-parks\",\n      \"visibility\",\n      visibility === \"none\" ? \"visible\" : \"none\"\n    );\n    const show = visibility === \"none\" ? true : false;\n    localStorage.setItem(\"showAllParks\", show);\n    setAppData({ showAllParks: show });\n  };\n\n  const handleParkSymbolClick = (e) => {\n    console.log(e);\n    console.log(e.features[0]);\n\n    const point = e.features[0];\n\n    if (popupData) {\n      const idobj = popupData.data.fields\n        ? popupData.data.fields.idobj\n        : popupData.data.properties.idobj;\n      if (idobj === point.properties.idobj) {\n        setShowPopup(false);\n\n        // Clear data after animation\n        setTimeout(() => {\n          setPopupData(undefined);\n        }, 300);\n        return;\n      }\n    }\n\n    setPopupData({ type: popupTypes.freeParkRide, data: point });\n    setShowPopup(true);\n  };\n\n  return (\n    <div className=\"Map\">\n      <div ref={mapContainer} className=\"mapContainer\" />\n      <Header\n        data={data}\n        onRefresh={getData}\n        onToggleAllParks={toggleAllParks}\n        isLoading={isLoading}\n      />\n      <Popup\n        data={popupData}\n        visible={showPopup}\n        onClick={() => setShowPopup(false)}\n      />\n    </div>\n  );\n}\n\nexport default Map;\n","import React from 'react';\n\nimport DataProvider from \"./dataProvider\";\nimport Map from './Map'\n\nconst App = () => {\n  return (\n    <DataProvider>\n      <div className=\"App\">\n        <Map />\n      </div>\n    </DataProvider>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport mapboxgl from 'mapbox-gl';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nmapboxgl.accessToken = process.env.REACT_APP_MAPBOX_API_KEY;\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}