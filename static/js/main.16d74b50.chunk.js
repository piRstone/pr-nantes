(this["webpackJsonppr-nantes"]=this["webpackJsonppr-nantes"]||[]).push([[0],[,,,,,,,,,,,function(e,t,a){e.exports=a(27)},,,,,function(e,t,a){},function(e,t,a){},,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(5),c=a.n(o),l=a(3),s=a.n(l),i=(a(16),a(4)),u=a(2),p=Object(n.createContext)(),m=function(e){var t=e.children,a=Object(n.useState)({}),o=Object(u.a)(a,2),c=o[0],l=o[1];return r.a.createElement(p.Provider,{value:{appData:c,setAppData:function(e){return l(Object(i.a)(Object(i.a)({},c),e))}}},t)},d=(a(17),a(6)),f=a(7),v=(a(23),a(24),function(e,t){Object(n.useEffect)((function(){var a=function(a){e.current&&!e.current.contains(a.target)&&t(a)};return document.addEventListener("mousedown",a),document.addEventListener("touchstart",a),function(){document.removeEventListener("mousedown",a),document.removeEventListener("touchstart",a)}}),[e,t])}),g=function(e){var t=e.onToggleAllParks,a=Object(n.useState)(!1),o=Object(u.a)(a,2),c=o[0],l=o[1],s=Object(n.useContext)(p).appData,i=Object(n.useRef)();return v(i,(function(){l(!1)})),r.a.createElement("div",{ref:i,className:"layer-selector"},r.a.createElement("div",{className:"layer-button",onClick:function(){return l(!c)}},r.a.createElement(d.a,{icon:f.a,className:"layer-icon",size:"lg"})),c&&r.a.createElement("div",{className:"layer-popup"},r.a.createElement("div",{className:"layer-row"},r.a.createElement("input",{id:"toggle-all-parks",className:"layer-input",type:"checkbox",checked:s.showAllParks,onChange:t}),r.a.createElement("label",{htmlFor:"toggle-all-parks",className:"layer-label"},"Afficher tous les parkings relais"))))};var b=function(e){var t=e.data,a=e.onRefresh,o=e.onToggleAllParks,c=e.isLoading,l=Object(n.useState)(void 0),s=Object(u.a)(l,2),i=s[0],m=s[1],v=Object(n.useContext)(p).setAppData;return Object(n.useEffect)((function(){if(t.length){var e=t[0].record_timestamp,a=new Date(e),n=a.getHours(),r=a.getMinutes();r=r<10?"0".concat(r):r,m("".concat(n,"h").concat(r)),v({count:t.length})}}),[t]),r.a.createElement("div",{className:"header-wrapper"},r.a.createElement("header",null,r.a.createElement("h1",{className:"header-title"},"P+R Nantes"),r.a.createElement("p",{className:"header-version"},"v1.2.0")),i&&r.a.createElement("div",{className:"header-timestamp-wrapper"},r.a.createElement("p",null,"Mis \xe0 jour aujourd'hui \xe0 ",i),r.a.createElement("button",{type:"button",onClick:a,className:"header-refresh-button"},r.a.createElement(d.a,{icon:f.b,color:"#616161",spin:c}))),r.a.createElement(g,{onToggleAllParks:o}))};a(25);var h=function(e){var t=e.data,a=e.onClick,n=t.fields.grp_disponible,o=t.fields.grp_statut,c="marker ".concat(0===n?"danger":n<10?"warning":"");return 0===o?(c+=" invalid",n="X"):1===o&&(c="marker danger",n="X"),r.a.createElement("div",{onClick:function(){return a(t)},className:c},n)};a(26);var E=function(e){var t=e.data,a=e.visible,n=e.onClick;if(!t)return r.a.createElement("div",{className:"popup-wrapper"});var o,c=t.fields,l=c.grp_nom,s=c.grp_disponible,i=c.grp_exploitation,u=c.grp_statut,p=s,m="popup-wrapper ".concat(a?"visible":""),d="popup-count ".concat(0===p?"danger":p<10?"warning":"");return o=0===p?"Aucune place disponible":1===p?"1 place disponible":"".concat(p," places disponibles"),0===u?(o="Comptage hors service",p="X",d+=" invalid"):1===u&&(o="Parking ferm\xe9",p="X",d="popup-count danger"),r.a.createElement("div",{className:m,onClick:n},r.a.createElement("div",{className:d},p),r.a.createElement("div",{className:"popup-informations"},r.a.createElement("h3",{className:"popup-park-name"},l),r.a.createElement("p",{className:""},o),r.a.createElement("p",null,"Nombre de places totales : ",r.a.createElement("strong",null,i))))};var k=function(){var e=Object(n.useContext)(p),t=e.appData,a=e.setAppData,o=Object(n.useState)(null),l=Object(u.a)(o,2),m=l[0],d=l[1],f=Object(n.useState)([]),v=Object(u.a)(f,2),g=v[0],k=v[1],j=Object(n.useState)([]),y=Object(u.a)(j,2),O=y[0],w=y[1],N=Object(n.useState)(!1),C=Object(u.a)(N,2),_=C[0],P=C[1],A=Object(n.useState)(void 0),S=Object(u.a)(A,2),x=S[0],L=S[1],M=Object(n.useState)(!1),T=Object(u.a)(M,2),D=T[0],I=T[1],R=Object(n.useRef)();Object(n.useEffect)((function(){console.log(navigator.platform);var e=localStorage.getItem("showAllParks");e&&a({showAllParks:"true"===e});m||function(e){var t=e.setMap,a=e.mapContainer,n=new s.a.Map({container:a.current,style:"mapbox://styles/mapbox/streets-v11",center:[-1.5543,47.2107],zoom:10});n.on("load",(function(){t(n),n.resize(),n.dragRotate.disable(),n.loadImage("/img/parking-symbol@3x.png",(function(e,t){if(e)throw e;n.addImage("parking-symbol",t)})),n.on("click","all-parks",X)}))}({setMap:d,mapContainer:R}),z()}),[]);var J=Object(n.useCallback)((function(e){if(x&&x.fields.idobj===e.fields.idobj)return I(!1),void setTimeout((function(){L(void 0)}),300);L(e),I(!0)}),[x]);Object(n.useEffect)((function(){m&&g.length&&g.forEach((function(e){var t;if(null===(t=e.fields)||void 0===t?void 0:t.location){var a=e.fields.grp_disponible,n=document.createElement("div");n.className="marker ".concat(0===a?"danger":a<10?"warning":""),n.innerText=a;var o=document.createElement("div");c.a.render(r.a.createElement(h,{data:e,onClick:J}),o);var l=e.fields.location;new s.a.Marker({element:o}).setLngLat([l[1],l[0]]).addTo(m)}}))}),[m,g,J]),Object(n.useEffect)((function(){if(m&&O.length){var e={type:"geojson",data:{type:"FeatureCollection",features:[]}};if(O.forEach((function(t){var a;if(null===(a=t.fields)||void 0===a?void 0:a.location){var n=t.fields.location,r={type:"Feature",geometry:{type:"Point",coordinates:[n[1],n[0]]},properties:Object(i.a)({name:t.fields.nom_complet},t.fields)};e.data.features.push(r)}})),!m.getSource("all-parks-source")){m.addSource("all-parks-source",e),m.addLayer({id:"all-parks",type:"symbol",source:"all-parks-source",layout:{"icon-image":"parking-symbol","icon-size":.25}});var a=!0===t.showAllParks?"visible":"none";m.setLayoutProperty("all-parks","visibility",a)}}}),[m,O,t]);var z=function(){P(!0);fetch("https://data.nantesmetropole.fr/api/records/1.0/search/?dataset=244400404_parcs-relais-nantes-metropole&q=&rows=100&facet=libtype&facet=commune&facet=service_velo&facet=autres_service_mob_prox&facet=conditions_d_acces&facet=exploitant").then((function(e){return e.json()})).then((function(e){w(e.records)}),(function(e){console.log("Error: ",e)}));fetch("https://data.nantesmetropole.fr/api/records/1.0/search/?dataset=244400404_parcs-relais-nantes-metropole-disponibilites&q=&rows=30&facet=grp_nom&facet=grp_statut").then((function(e){return e.json()})).then((function(e){P(!1),k(e.records)}),(function(e){P(!1),console.log("Error: ",e)}))},X=function(e){console.log(e),console.log(e.features[0])};return r.a.createElement("div",{className:"Map"},r.a.createElement("div",{ref:R,className:"mapContainer"}),r.a.createElement(b,{data:g,onRefresh:z,onToggleAllParks:function(){var e=m.getLayoutProperty("all-parks","visibility");m.setLayoutProperty("all-parks","visibility","none"===e?"visible":"none");var t="none"===e;localStorage.setItem("showAllParks",t),a({showAllParks:t})},isLoading:_}),r.a.createElement(E,{data:x,visible:D,onClick:function(){return I(!1)}}))},j=function(){return r.a.createElement(m,null,r.a.createElement("div",{className:"App"},r.a.createElement(k,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.accessToken="pk.eyJ1IjoicGlyc3RvbmUiLCJhIjoiY2tmNDMzNTd4MDk1YTJxczdleXdqM2lrZiJ9.Og2gHJR4QWSTe20-7pq9Iw",c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(j,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[11,1,2]]]);
//# sourceMappingURL=main.16d74b50.chunk.js.map