(this["webpackJsonppr-nantes"]=this["webpackJsonppr-nantes"]||[]).push([[0],[,,,,,,,,,,,,,function(e,t,a){e.exports=a(30)},,,,,function(e,t,a){},,function(e,t,a){},,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(7),o=a.n(c),s=a(4),i=a.n(s),l=(a(18),a(6)),p=a(2),u=Object(n.createContext)(),d=function(e){var t=e.children,a=Object(n.useState)({}),c=Object(p.a)(a,2),o=c[0],s=c[1];return r.a.createElement(u.Provider,{value:{appData:o,setAppData:function(e){return s(Object(l.a)(Object(l.a)({},o),e))}}},t)},m=a(3),f=a.n(m),v=a(5),b=(a(20),a(8)),g=a(9),h=(a(26),a(27),function(e,t){Object(n.useEffect)((function(){var a=function(a){e.current&&!e.current.contains(a.target)&&t(a)};return document.addEventListener("mousedown",a),document.addEventListener("touchstart",a),function(){document.removeEventListener("mousedown",a),document.removeEventListener("touchstart",a)}}),[e,t])}),E=function(e){var t=e.onToggleAllParks,a=Object(n.useState)(!1),c=Object(p.a)(a,2),o=c[0],s=c[1],i=Object(n.useContext)(u).appData,l=Object(n.useRef)();return h(l,(function(){s(!1)})),r.a.createElement("div",{ref:l,className:"layer-selector"},r.a.createElement("div",{className:"layer-button",onClick:function(){return s(!o)}},r.a.createElement(b.a,{icon:g.a,className:"layer-icon",size:"lg"})),o&&r.a.createElement("div",{className:"layer-popup"},r.a.createElement("div",{className:"layer-row"},r.a.createElement("input",{id:"toggle-all-parks",className:"layer-input",type:"checkbox",checked:i.showAllParks,onChange:t}),r.a.createElement("label",{htmlFor:"toggle-all-parks",className:"layer-label"},"Afficher tous les parkings relais"))))};var k=function(e){var t=e.data,a=e.onRefresh,c=e.onToggleAllParks,o=e.isLoading,s=Object(n.useState)(void 0),i=Object(p.a)(s,2),l=i[0],d=i[1],m=Object(n.useContext)(u).setAppData;return Object(n.useEffect)((function(){if(t.length){var e=t[0].record_timestamp,a=new Date(e),n=a.getHours(),r=a.getMinutes();r=r<10?"0".concat(r):r,d("".concat(n,"h").concat(r)),m({count:t.length})}}),[t]),r.a.createElement("div",{className:"header-wrapper"},r.a.createElement("header",null,r.a.createElement("h1",{className:"header-title"},"P+R Nantes"),r.a.createElement("p",{className:"header-version"},"v1.2.0")),l&&r.a.createElement("div",{className:"header-timestamp-wrapper"},r.a.createElement("p",null,"Mis \xe0 jour aujourd'hui \xe0 ",l),r.a.createElement("button",{type:"button",onClick:a,className:"header-refresh-button"},r.a.createElement(b.a,{icon:g.b,color:"#616161",spin:o}))),r.a.createElement(E,{onToggleAllParks:c}))};a(28);var j=function(e){var t=e.data,a=e.onClick,n=t.fields.grp_disponible,c=t.fields.grp_statut,o="marker ".concat(0===n?"danger":n<10?"warning":"");return 0===c?(o+=" invalid",n="X"):1===c&&(o="marker danger",n="X"),r.a.createElement("div",{onClick:function(){return a(t)},className:o},n)},y=(a(29),function(e){var t,a=e.data.fields,n=a.grp_nom,c=a.grp_disponible,o=a.grp_exploitation,s=a.grp_statut,i=c,l="popup-count ".concat(0===i?"danger":i<10?"warning":"");return t=0===i?"Aucune place disponible":1===i?"1 place disponible":"".concat(i," places disponibles"),0===s?(t="Comptage hors service",i="X",l+=" invalid"):1===s&&(t="Parking ferm\xe9",i="X",l="popup-count danger"),r.a.createElement("div",{className:"popup-wrapper"},r.a.createElement("div",{className:l},i),r.a.createElement("div",{className:"popup-informations"},r.a.createElement("h3",{className:"popup-park-name"},n),r.a.createElement("p",{className:""},t),r.a.createElement("p",null,"Nombre de places totales : ",r.a.createElement("strong",null,o))))}),w=function(e){var t=e.data;console.info("INFO",t);var a=t.properties,n=a.nom_complet,c=a.capacite_voiture;return r.a.createElement("div",{className:"popup-wrapper"},r.a.createElement("img",{src:"".concat("","/img/parking-symbol@2x.png"),alt:"Parking icon"}),r.a.createElement("div",{className:"popup-informations"},r.a.createElement("h3",{className:"popup-park-name"},n),r.a.createElement("p",null,"Nombre de places totales : ",r.a.createElement("strong",null,c))))},O="realTime",N="freeParkRide";var _=function(e){var t=e.data,a=e.visible,n=e.onClick;if(!t)return r.a.createElement("div",{className:"popup"});var c="popup ".concat(a?"visible":"");return r.a.createElement("div",{className:c,onClick:n},t.type===O&&r.a.createElement(y,{data:t.data}),t.type===N&&r.a.createElement(w,{data:t.data}))},x=function(){var e=Object(v.a)(f.a.mark((function e(){var t,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://data.nantesmetropole.fr/api/records/1.0/search/?dataset=244400404_parcs-relais-nantes-metropole&q=&rows=100&facet=libtype&facet=commune&facet=service_velo&facet=autres_service_mob_prox&facet=conditions_d_acces&facet=exploitant",e.prev=1,e.next=4,fetch("https://data.nantesmetropole.fr/api/records/1.0/search/?dataset=244400404_parcs-relais-nantes-metropole&q=&rows=100&facet=libtype&facet=commune&facet=service_velo&facet=autres_service_mob_prox&facet=conditions_d_acces&facet=exploitant");case 4:return t=e.sent,e.next=7,t.json();case 7:return a=e.sent,e.abrupt("return",a.records);case 11:throw e.prev=11,e.t0=e.catch(1),Error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(){return e.apply(this,arguments)}}(),C=function(){var e=Object(v.a)(f.a.mark((function e(){var t,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://data.nantesmetropole.fr/api/records/1.0/search/?dataset=244400404_parcs-relais-nantes-metropole-disponibilites&q=&rows=30&facet=grp_nom&facet=grp_statut",e.prev=1,e.next=4,fetch("https://data.nantesmetropole.fr/api/records/1.0/search/?dataset=244400404_parcs-relais-nantes-metropole-disponibilites&q=&rows=30&facet=grp_nom&facet=grp_statut");case 4:return t=e.sent,e.next=7,t.json();case 7:return a=e.sent,e.abrupt("return",a.records);case 11:throw e.prev=11,e.t0=e.catch(1),Error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(){return e.apply(this,arguments)}}();var P=function(){var e=Object(n.useContext)(u),t=e.appData,a=e.setAppData,c=Object(n.useState)(null),s=Object(p.a)(c,2),d=s[0],m=s[1],b=Object(n.useState)([]),g=Object(p.a)(b,2),h=g[0],E=g[1],y=Object(n.useState)([]),w=Object(p.a)(y,2),P=w[0],A=w[1],S=Object(n.useState)(!1),L=Object(p.a)(S,2),T=L[0],M=L[1],D=Object(n.useState)(void 0),I=Object(p.a)(D,2),R=I[0],J=I[1],q=Object(n.useState)(!1),z=Object(p.a)(q,2),X=z[0],F=z[1],W=Object(n.useRef)();Object(n.useEffect)((function(){var e=localStorage.getItem("showAllParks");e&&a({showAllParks:"true"===e});d||function(e){var t=e.setMap,a=e.mapContainer,n=new i.a.Map({container:a.current,style:"mapbox://styles/mapbox/streets-v11",center:[-1.5543,47.2107],zoom:10});n.on("load",(function(){t(n),n.resize(),n.dragRotate.disable(),n.loadImage("/img/parking-symbol@3x.png",(function(e,t){if(e)throw e;n.addImage("parking-symbol",t)})),n.on("click","all-parks",Y)}))}({setMap:m,mapContainer:W}),H()}),[]);var B=Object(n.useCallback)((function(e){if(R&&(R.data.fields?R.data.fields.idobj:R.data.properties.idobj)===e.fields.idobj)return F(!1),void setTimeout((function(){J(void 0)}),300);J({type:O,data:e}),F(!0)}),[R]);Object(n.useEffect)((function(){d&&h.length&&h.forEach((function(e){var t;if(null===(t=e.fields)||void 0===t?void 0:t.location){var a=e.fields.grp_disponible,n=document.createElement("div");n.className="marker ".concat(0===a?"danger":a<10?"warning":""),n.innerText=a;var c=document.createElement("div");o.a.render(r.a.createElement(j,{data:e,onClick:B}),c);var s=e.fields.location;new i.a.Marker({element:c}).setLngLat([s[1],s[0]]).addTo(d)}}))}),[d,h,B]),Object(n.useEffect)((function(){if(d&&P.length){var e={type:"geojson",data:{type:"FeatureCollection",features:[]}};if(P.forEach((function(t){var a;if(null===(a=t.fields)||void 0===a?void 0:a.location){var n=t.fields.location,r={type:"Feature",geometry:{type:"Point",coordinates:[n[1],n[0]]},properties:Object(l.a)({name:t.fields.nom_complet},t.fields)};e.data.features.push(r)}})),!d.getSource("all-parks-source")){d.addSource("all-parks-source",e),d.addLayer({id:"all-parks",type:"symbol",source:"all-parks-source",layout:{"icon-image":"parking-symbol","icon-size":.25}});var a=!0===t.showAllParks?"visible":"none";d.setLayoutProperty("all-parks","visibility",a)}}}),[d,P,t]);var H=function(){var e=Object(v.a)(f.a.mark((function e(){var t,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M(!0),e.prev=1,e.next=4,x();case 4:t=e.sent,A(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:return e.prev=11,e.next=14,C();case 14:a=e.sent,E(a),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(11),console.error(e.t1);case 21:M(!1);case 22:case"end":return e.stop()}}),e,null,[[1,8],[11,18]])})));return function(){return e.apply(this,arguments)}}(),Y=function(e){console.log(e),console.log(e.features[0]);var t=e.features[0];if(R&&(R.data.fields?R.data.fields.idobj:R.data.properties.idobj)===t.properties.idobj)return F(!1),void setTimeout((function(){J(void 0)}),300);J({type:N,data:t}),F(!0)};return r.a.createElement("div",{className:"Map"},r.a.createElement("div",{ref:W,className:"mapContainer"}),r.a.createElement(k,{data:h,onRefresh:H,onToggleAllParks:function(){var e=d.getLayoutProperty("all-parks","visibility");d.setLayoutProperty("all-parks","visibility","none"===e?"visible":"none");var t="none"===e;localStorage.setItem("showAllParks",t),a({showAllParks:t})},isLoading:T}),r.a.createElement(_,{data:R,visible:X,onClick:function(){return F(!1)}}))},A=function(){return r.a.createElement(d,null,r.a.createElement("div",{className:"App"},r.a.createElement(P,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.accessToken="pk.eyJ1IjoicGlyc3RvbmUiLCJhIjoiY2tmNDMzNTd4MDk1YTJxczdleXdqM2lrZiJ9.Og2gHJR4QWSTe20-7pq9Iw",o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(A,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[13,1,2]]]);
//# sourceMappingURL=main.fec54eb6.chunk.js.map